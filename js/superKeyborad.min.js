(function(){function a(m){let o=m.slice(-1),p=m.slice(0,-1),q='B'==p?parseInt(o)+1:o,r=Object.keys(k),s=r.indexOf(p)+1,t='B'==p?'C':r[s];return t+q}function b(m){let o=m.slice(-1),p=m.slice(0,-1);return k[p]*Math.pow(2,o-3)}function d(m,o){return Object.keys(m).find(p=>m[p]===o)}let e=this,f=!1,g={},j;const k={C:261.626,'C#':277.183,D:293.665,'D#':311.127,E:329.628,F:349.228,'F#':369.994,G:391.995,'G#':415.305,A:440,'A#':466.164,B:493.883},l={0:0,1:0,2:1,3:1,4:2,5:3,6:3,7:4,8:4,9:5,10:5,11:6};Keyborad=function(m){m==void 0&&(m={}),this.keyboardMap={},this.keysMap={A:'C3',S:'D3',D:'E3',F:'F3',G:'G3',H:'A3',J:'B3',K:'C4',W:'C#3',E:'D#3',T:'F#3',Y:'G#3',U:'A#3'},this.divID=m.divID||'keyborad',this.octaves=m.octaves||3,this.width=m.width||800,this.borderSize=m.borderSize||0,this.borderSizeTop=m.borderSizeTop||0,this.borderSizeOffset=m.borderSizeOffset||0,this.borderColor=m.borderColor||'black',this.borderBorderSize=m.borderBorderSize||0,this.borderBorderColor=m.borderBorderColor||'black',this.borderRadius=m.borderRadius||20,this.borderText=m.borderText||'',this.noteWidth=(this.width-2*this.borderSize)/(7*this.octaves+1),this.noteHeight=m.height||200,this.firstNote=m.firstNote||'C2',this.showKey=m.showKey||!1,this.autoSetUp=!(void 0!=m.autoSetUp)||m.autoSetUp,this.selectColor=m.selectColor||'#7FDBFF',this.whiteNoteColor=m.whiteNoteColor||'white',this.blackNoteColor=m.blackNoteColor||'black',this.autoSetUp&&(this.context=new AudioContext,this.mixNode=this.context.createGain(),this.mixNode.gain.value=0.3,this.mixNode.connect(this.context.destination),this.nodes=[]),this.init()},Keyborad.prototype.init=function(){let m='#'+this.divID;$(m).length||$('body').append('<div id="'+this.divID+'"</div>'),$(m).empty(),$(m).css('height',this.noteHeight+this.borderSizeTop),$(m).css('width',this.width);let o=this.firstNote.slice(0,-1),p=o.slice(-1),q,r=this.firstNote;for(let x=0;12>x;x++)Object.keys(k)[x]==o&&(q=x);this.keyboardMap={},this.keyboardMap[q]=r;for(let x=q+1;x<13*this.octaves+q;x++)this.keyboardMap[x]=a(r),r=this.keyboardMap[x];$(m).append('<ul style=" margin:0px;list-style-type: none;position: relative;" ondragstart="return false;" ondrop="return false;"></ul>');let s='#'==p?-this.noteWidth/2:0,t=0;for(let x=0;x<7*this.octaves+l[q]+1;x++)t>=q&&(x<7*this.octaves+l[q]+1||'#'==p)?$(m+' ul').append('<li>'+this.createNote('white',this.noteWidth*x-s+this.borderSize+this.borderBorderSize,t)+'</li>'):s+=this.noteWidth,t++,2!=x%7&&6!=x%7&&(t>=q&&x<7*this.octaves+l[q]+('#'==p?1:0)&&$(m+' ul').append('<li>'+this.createNote('black',this.noteWidth*x+2*(this.noteWidth/3)-s+this.borderSize+this.borderBorderSize,t)+'</li>'),t++);if(0<this.borderSize||0<this.borderSizeTop){let x='border-top: '+this.borderBorderSize+'px solid '+this.borderBorderColor+';',y='border-left: '+this.borderBorderSize+'px solid '+this.borderBorderColor+';',z='border-right: '+this.borderBorderSize+'px solid '+this.borderBorderColor+';',A='border-bottom: '+this.borderBorderSize+'px solid '+this.borderBorderColor+';',B='border-top-left-radius: '+this.borderRadius+'px;',C='border-top-right-radius: '+this.borderRadius+'px;',D='border-bottom-left-radius: '+this.borderRadius+'px;',E='border-bottom-right-radius: '+this.borderRadius+'px;',F='background-color:'+this.borderColor+';',G='width:'+(this.borderSize+this.width/2)+'px;',H='height:'+(this.noteHeight+this.borderSizeTop-1*this.borderBorderSize+this.borderSizeOffset)+'px;',I='text-align:center;font-weight:bold;font-size:'+5*this.borderSizeTop/6+'px; color:'+this.borderBorderColor+';',K='z-index : -100;';$(m).append('<div class="keyboradTop" style="'+K+I+'-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;'+x+y+z+B+C+'top:0px;width:'+(this.width+this.borderBorderSize-3)+'px;height:'+this.borderSizeTop+'px; px;'+F+'">'+this.borderText+'</div>'),$(m).append('<div class="keyboradLeft" style="'+K+x+A+y+D+B+' position: relative;top:-'+(this.borderSizeTop+this.borderBorderSize)+'px;left:0px; '+G+H+F+'"></div>'),$(m).append('<div class="keyboradRight" style="'+K+x+A+z+E+C+'position:relative;top:-'+(2*this.borderSizeTop+this.noteHeight+2*this.borderBorderSize+this.borderSizeOffset)+'px;left:'+(this.width-this.borderSize-this.width/2+this.borderBorderSize+2)+'px;'+G+H+F+'"></div>')}let u=this,v='#'+this.divID+' .note';$(v).mousedown(function(){let x=$(this).attr('id');f=!0,u.onPressNoteID(x)}),$(v).mouseup(function(){let x=$(this).attr('id');u.onReleaseNoteID(x)}),$(v).mouseenter(function(){if(f){let x=$(this).attr('id');u.onPressNoteID(x)}}),$(v).mouseleave(function(){if(f&&$(this).hasClass('played')){let x=$(this).attr('id');u.onReleaseNoteID(x)}}),$(document).mouseup(function(){f=!1}),document.onkeydown=function(x){if(j=x.keyCode||window.event,!(j in g)){g[j]=!0;let y=String.fromCharCode(j);u.onPressNoteID(d(u.keyboardMap,u.keysMap[y]))}},document.onkeyup=function(x){j=x.keyCode||window.event,delete g[j];let y=String.fromCharCode(j);y in u.keysMap&&u.onReleaseNoteID(d(u.keyboardMap,u.keysMap[y]))}},Keyborad.prototype.createNote=function(m,o,p){let r='position:absolute; left:'+o+'px;top:'+(this.borderSizeTop+this.borderBorderSize)+'px;',s='white'==m?this.noteWidth:2*this.noteWidth/3,t='white'==m?this.noteHeight:5.5*this.noteHeight/9,x='background-color: '+('white'==m?this.whiteNoteColor:this.blackNoteColor)+';',z='black'==m?'z-index: 10;':'',A='';if(this.showKey){let B=d(this.keysMap,this.keyboardMap[p]);B==void 0&&(B='');let D='white'==m?'color: '+this.blackNoteColor+';':'color:'+this.whiteNoteColor+';',E='white'==m?this.noteWidth/3:this.noteWidth/6;A='<div style="'+'-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;'+D+('position:absolute;bottom:0px;padding:'+E+'px;')+'">'+B+'</div'}return'<div  id="'+p+('"class="note '+m+'"')+'" style = "font-weight:bold;'+r+('width:'+s+'px;')+('height:'+t+'px;')+x+'border: 1px solid black; border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;'+z+'">'+A+'</div>'},Keyborad.prototype.onPressNoteID=function(m){if('undefined'!=typeof this.keyboardMap[m]){let o='#'+this.divID+' #'+m;$(o).css('background-color',this.selectColor),$(o).addClass('played');let p=b(this.keyboardMap[m]);this.pressNote(p)}},Keyborad.prototype.pressNote=function(m){if(this.autoSetUp){let o=this.context.createOscillator();o.type='square',o.frequency.value=m,o.connect(this.mixNode),o.start(0),this.nodes.push(o)}},Keyborad.prototype.onReleaseNoteID=function(m){if('undefined'!=typeof this.keyboardMap[m]){let o='#'+this.divID+' #'+m,p=$(o).hasClass('white')?'white':'black';$(o).css('background-color','white'==p?this.whiteNoteColor:this.blackNoteColor),$(o).removeClass('played');let q=b(this.keyboardMap[m]);this.releaseNote(q)}},Keyborad.prototype.releaseNote=function(m){if(this.autoSetUp){let o=[];for(let p=0;p<this.nodes.length;p++)Math.round(this.nodes[p].frequency.value)===Math.round(m)?(this.nodes[p].stop(0),this.nodes[p].disconnect()):o.push(this.nodes[p]);this.nodes=o}},Keyborad.prototype.addKeyBinding=function(m,o){this.keysMap[m]=o,this.init()}})();